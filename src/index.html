<!doctype html>
<html lang="en" class="dark m-0 h-full w-full bg-zinc-950 px-0">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MIDI SysEx Utility</title>

    <!-- Scripts -->
    <script type="module" src="./main.js" defer></script>
    <link rel="preconnect" href="https://fonts.bunny.net" />
    <link
      href="https://fonts.bunny.net/css?family=inter:100,200,300,400,500,600,700,800|jetbrains-mono:100,200,300,400,500,600,700,800"
      rel="stylesheet"
    />

    <!-- Style -->
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/dist/tippy.css" />
    <style>
      [x-cloak] {
        display: none;
      }
    </style>
  </head>
  <body
    class="h-full w-full overflow-hidden bg-slate-950 text-slate-200 antialiased"
  >
    <div
      x-cloak
      x-data="app"
      x-on:keydown.window.shift.f="toggleFilter"
      class="flex h-full flex-col"
    >
      <header class="flex flex-row items-center justify-between gap-2 pl-3">
        <h1 class="whitespace-nowrap text-sm font-bold text-slate-700">
          SysEx Utility
        </h1>

        <div class="flex-1"></div>

        <div
          class="ml-auto flex flex-row items-center justify-between gap-2 py-1"
        >
          <div class="flex flex-row gap-2">
            <select
              id="midiInput"
              x-model="selectedInput"
              x-on:change="handleInputChange"
              class="input focusable w-40 !bg-slate-900"
            >
              <option value="">Select MIDI Input</option>
              <template x-for="input in midiInputs" :key="`input-${input.id}`">
                <option x-bind:value="input.id" x-text="input.name"></option>
              </template>
            </select>
            <select
              id="midiOutput"
              x-model="selectedOutput"
              x-on:change="handleOutputChange"
              class="input focusable w-40 !bg-slate-900"
            >
              <option value="">Select MIDI Output</option>
              <template
                x-for="output in midiOutputs"
                :key="`output-${output.id}`"
              >
                <option x-bind:value="output.id" x-text="output.name"></option>
              </template>
            </select>
          </div>
        </div>

        <div class="status-bar ml-auto whitespace-nowrap">
          <div class="flex flex-col justify-center gap-1.5 text-left">
            <span
              class="inline-block text-[10px] font-light leading-none text-slate-500"
            >
              Version
            </span>
            <span class="inline-block text-xs font-medium leading-none">
              v1.2.3
            </span>
          </div>
          <div class="flex flex-col justify-center gap-1.5 text-left">
            <span
              class="inline-block text-[10px] font-light leading-none text-slate-500"
            >
              Connected
            </span>
            <span class="inline-block text-xs font-medium leading-none">
              Yes
            </span>
          </div>
          <div class="flex flex-col justify-center gap-1.5 text-left">
            <span
              class="inline-block text-[10px] font-light leading-none text-slate-500"
            >
              MIDI Manufacturer
            </span>
            <span class="inline-block text-xs font-medium leading-none">
              Yamaha Corporation
            </span>
          </div>
        </div>
      </header>

      <div class="flex h-full flex-1 flex-row">
        <div class="h-full w-1/2 flex-1 border-r border-zinc-800">
          <div
            class="flex items-center justify-between gap-3 border-y border-slate-800 bg-slate-900 px-3 py-0.5"
          >
            <span class="mr-auto font-mono text-xs leading-none">
              Data entry
            </span>

            <button
              x-tooltip.raw="When enabled, the app will ask for confirmation before sending a SysEx message, as it could potentially damage your devices"
              x-on:click="safeMode = !safeMode"
              class="command-button"
            >
              <span
                x-text="safeMode ? 'Safe mode: On' : 'Safe mode: Off'"
              ></span>
            </button>

            <button
              x-tooltip.raw="Makes the app play a jazz lick, because why not ðŸŽ· Mostly for testing that the MIDI output is working"
              x-on:click="playJazzLick"
              class="command-button"
            >
              <span>Play Jazz Lick ðŸŽ·</span>
            </button>
            <button
              x-tooltip.raw="Load the contents of a file into the input field, does NOT send the message without pressing enter"
              x-on:click="loadFile"
              class="command-button"
            >
              <span>Load file</span>
            </button>

            <button
              x-tooltip.raw="Clears the input field"
              x-on:click="clearMessage"
              class="command-button"
            >
              <span>Clear</span>
            </button>
            <button
              x-tooltip.raw="Restores the last cleared message, because sometimes you didn't mean to clear it ðŸ™ƒ"
              x-show="clearedMessage"
              x-on:click="restoreClearedMessage"
              class="command-button"
            >
              <span>Restore cleared</span>
            </button>
          </div>

          <textarea
            x-ref="messageInput"
            x-on:keydown.enter="sendInput"
            x-model="message"
            class="textarea placeholder-gray-700"
            :placeholder="`Write a midi message as HEX and press enter to send it.\nexample:\n90 48 7f (note on)\n80 48 00 (note off)`"
          ></textarea>
        </div>
        <div class="flex h-full w-1/2 flex-1 flex-col">
          <div
            class="flex items-center justify-between gap-3 border-y border-slate-800 bg-slate-900 px-3 py-0.5"
          >
            <span class="mr-auto font-mono text-xs leading-none">
              MIDI Monitor
            </span>

            <button
              x-tooltip.raw="When enabled, the app will automatically scroll to the bottom of the log window when new messages are added"
              x-on:click="toggleAutoScroll"
              class="command-button !w-auto"
            >
              <svg
                x-show="!autoScroll"
                class="size-4"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 17V3" />
                <path d="m6 11 6 6 6-6" />
                <path d="M19 21H5" />
              </svg>

              <svg
                x-show="autoScroll"
                class="size-4"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="14" y="4" width="4" height="16" rx="1" />
                <rect x="6" y="4" width="4" height="16" rx="1" />
              </svg>
            </button>

            <div class="relative">
              <button
                x-ref="button"
                x-on:click="toggleFilter"
                class="command-button"
              >
                <span>Filter</span>
              </button>

              <div
                x-transition.origin.top.right
                x-on:click.outside="showFilter = false"
                x-trap="showFilter"
                x-show="showFilter"
                class="absolute right-2 top-3 z-40 mt-8"
              >
                <div
                  class="flex w-72 flex-col gap-6 rounded-md border border-slate-800 bg-slate-900 p-4"
                >
                  <div>
                    <span class="mb-2 block text-xs font-medium text-slate-500">
                      Search
                    </span>

                    <input
                      x-model="filterSearch"
                      type="search"
                      placeholder="Search"
                      class="input focusable block w-full border border-slate-950 bg-slate-950/50"
                    />
                  </div>

                  <div>
                    <div
                      class="mb-2 flex flex-row items-center justify-between gap-2"
                    >
                      <span class="block text-xs font-medium text-slate-500">
                        Message Types
                      </span>

                      <button
                        class="inline-block w-auto py-0.5 text-xs"
                        x-on:click="filterTypes = [];"
                      >
                        Select all
                      </button>
                    </div>

                    <select
                      x-model="filterTypes"
                      multiple
                      class="input focusable block h-40 w-full border border-slate-950 bg-slate-950/50 font-mono"
                    >
                      <option value="sysex">SysEx</option>
                      <option value="midi">MIDI</option>
                      <option value="warning">Warning</option>
                      <option value="error">Error</option>
                      <option value="info">Info</option>
                      <option value="debug">Debug</option>
                      <option value="comment">Comment</option>
                      <option value="alert">Alert</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <button
              x-tooltip.raw="Compact mode will only show the message data itself, while standard mode will show the message type, the message, and the timestamp, enable if you want to see more messages at once"
              x-on:click="showLegend = !showLegend; showTimestamps = !showTimestamps"
              class="command-button"
            >
              <span x-text="showLegend ? 'Compact' : 'Standard'"></span>
            </button>

            <button x-on:click="toggleDummyData" class="command-button">
              <span>Make fake data</span>
            </button>
            <button x-on:click="clearLog" class="command-button">
              <span>Clear</span>
            </button>
          </div>

          <div
            x-ref="logWindow"
            class="flex-1 overflow-y-auto bg-zinc-950 pb-12 font-mono text-xs"
          >
            <template
              x-for="(log, index) in filteredLogMessages"
              :key="`log-${index}`"
            >
              <div
                class="flex cursor-pointer flex-col border-2 border-black p-1 px-2 leading-5 transition-all duration-100 ease-in-out hover:bg-slate-100/5 hover:brightness-110"
                x-bind:class="{
                  'text-emerald-400 hover:!bg-emerald-800/10': log.type === 'sysex',
                  'text-cyan-400 bg-cyan-800/15 hover:!bg-cyan-800/25': log.type === 'midi',
                  'text-yellow-400': log.type === 'warning',
                  'text-red-400': log.type === 'error',
                  'text-gray-400': log.type === 'info',
                  'text-purple-400': log.type === 'debug',
                  'text-slate-500': log.type === 'comment',
                  'bg-green-800/20 text-green-300': log.type === 'success',
                  'text-black bg-yellow-500 hover:bg-yellow-500 leading-none font-bold': log.type === 'alert',

                }"
              >
                <button
                  class="mb-0.5 flex flex-row items-center justify-between text-xs"
                >
                  <span
                    x-show="showTimestamps"
                    class="mr-4 block whitespace-nowrap font-mono font-light tabular-nums opacity-50"
                    x-text="`#${index + 1}`"
                  ></span>
                  <span
                    x-show="showLegend"
                    class="block whitespace-nowrap opacity-30"
                    x-text="log.type"
                  ></span>

                  <span class="w-full"></span>

                  <span
                    x-show="showTimestamps"
                    class="block whitespace-nowrap opacity-30"
                    x-text="log.timestamp"
                  ></span>
                </button>

                <code
                  class="block whitespace-pre-line font-mono text-xs"
                  x-text="log.message"
                ></code>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
